---
phase: 08-rating-system
plan: 03
type: execute
wave: 2
depends_on:
  - 08-02
  - 07-01
files_modified:
  - lib/planning/selection.ts
  - lib/actions/plans.ts
  - lib/planning/selection.test.ts
  - lib/actions/plans.test.ts
autonomous: true
---

# 08-03 Plan: Rating-Weighted Plan Selection

## Objective
Use ratings to bias generation while preserving variety guarantees.

## Scope
- Add weighted candidate selection that favors `THUMBS_UP` and de-prioritizes `THUMBS_DOWN`.
- Preserve Phase 7 guards (no duplicate week, 14-day recency priority, graceful fallback).
- Never exclude down-rated meals entirely.

## Tasks
1. Extend selection logic to apply weight factors:
   - `THUMBS_UP`: 2x
   - `NEUTRAL`: 1x
   - `THUMBS_DOWN`: 0.5x (or equivalent lower probability)
2. Keep fallback cascade behavior and warning semantics stable.
3. Add deterministic tests to verify weighting effect trends.

## Verification
- Over repeated runs, thumbs-up appears more often than neutral.
- Thumbs-down still appears occasionally.
- Existing Phase 7 tests continue to pass.

## Success Criteria
- `RATING-04`, `RATING-05`, `RATING-06` are satisfied.
