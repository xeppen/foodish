---
phase: 06-database-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
autonomous: true

must_haves:
  truths:
    - "Meals can have a rating (THUMBS_DOWN/NEUTRAL/THUMBS_UP)"
    - "Meals can have a complexity level (SIMPLE/MEDIUM/COMPLEX)"
    - "Rating and complexity fields persist explicit defaults (NEUTRAL/MEDIUM)"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "Rating enum definition"
      contains: "enum Rating"
    - path: "prisma/schema.prisma"
      provides: "Complexity enum definition"
      contains: "enum Complexity"
    - path: "prisma/schema.prisma"
      provides: "Meal model with rating and complexity fields"
      contains: "rating     Rating?"
  key_links:
    - from: "Meal model"
      to: "Rating enum"
      via: "rating field reference"
      pattern: "rating\\s+Rating\\?"
    - from: "Meal model"
      to: "Complexity enum"
      via: "complexity field reference"
      pattern: "complexity\\s+Complexity\\?"
    - from: "Meal model"
      to: "Composite indexes"
      via: "@@index directives"
      pattern: "@@index\\(\\[userId, rating\\]\\)"
---

<objective>
Extend Prisma schema with Rating and Complexity enums to support meal preferences and preparation time tracking.

Purpose: Enable users to express meal preferences (thumbs up/down) and track preparation complexity (simple/medium/complex) in future phases. These fields are foundational for smart variety logic (Phase 7) and rating UI (Phase 8).

Output: Updated schema.prisma with enum types, defaulted fields on Meal model, and composite indexes for filtered queries.
</objective>

<execution_context>
@/Users/seblju/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seblju/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-database-foundation/06-RESEARCH.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Add Rating and Complexity enums to schema</name>
  <files>prisma/schema.prisma</files>
  <action>
Add two enum definitions at the top of schema.prisma (after datasource/generator blocks, before models):

```prisma
enum Rating {
  THUMBS_DOWN
  NEUTRAL
  THUMBS_UP
}

enum Complexity {
  SIMPLE
  MEDIUM
  COMPLEX
}
```

Then extend the Meal model to include these fields with explicit defaults:

```prisma
model Meal {
  id         String          @id @default(cuid())
  name       String
  userId     String
  lastUsed   DateTime?
  rating     Rating          @default(NEUTRAL)
  complexity Complexity      @default(MEDIUM)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  @@index([userId])
  @@index([userId, rating])        // Composite for filtered queries
  @@index([userId, complexity])    // Composite for filtered queries
}
```

CRITICAL:
- Use explicit defaults (`@default(NEUTRAL)`, `@default(MEDIUM)`)
- Keep enum creation and column creation in migration order generated by Prisma
- Add composite indexes with userId as leftmost column (multi-tenant query pattern)
- Existing Meal model has @@index([userId]) - keep it, add two new composite indexes

Why defaults: App is pre-launch. Explicit defaults simplify downstream logic and testing.
  </action>
  <verify>
Run `npx prisma format` to validate schema syntax (should succeed with no errors).
Check schema.prisma contains:
- Two enum definitions (Rating, Complexity)
- rating and complexity fields in Meal model (both defaulted)
- rating and complexity fields in Meal model with explicit defaults
- Three @@index directives in Meal model (userId, userId+rating, userId+complexity)
  </verify>
  <done>
Schema file updated with Rating/Complexity enums, defaulted fields added to Meal model, composite indexes defined. Schema passes Prisma validation.
  </done>
</task>

</tasks>

<verification>
1. Run `npx prisma format` - should format successfully without errors
2. Check schema contains enums: `grep -A 3 "enum Rating" prisma/schema.prisma`
3. Check Meal model has new fields: `grep "rating\|complexity" prisma/schema.prisma`
4. Check composite indexes exist: `grep "@@index.*userId.*rating" prisma/schema.prisma`
</verification>

<success_criteria>
- Rating enum exists with 3 values (THUMBS_DOWN, NEUTRAL, THUMBS_UP)
- Complexity enum exists with 3 values (SIMPLE, MEDIUM, COMPLEX)
- Meal model has rating field (Rating with @default(NEUTRAL))
- Meal model has complexity field (Complexity with @default(MEDIUM))
- Meal model has composite indexes for [userId, rating] and [userId, complexity]
- Schema passes Prisma validation (prisma format succeeds)
</success_criteria>

<output>
After completion, create `.planning/phases/06-database-foundation/06-01-SUMMARY.md` following the standard summary template.
</output>
